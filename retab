#!/bin/bash
spacesPerTab=0

{
while IFS= read -r line 
	do
		# Debug echo "$line"
		numSpaces="$(echo "$line" | sed -e 's?\( *\).*$?\1?' | awk '{ print length }')"
		# debug echo $numSpaces
		if [ "$spacesPerTab" == "0" ]
		then
			if [ "$numSpaces" != "0" ]
				then
				spacesPerTab=$numSpaces
			else
				echo "$line"
				continue;
			fi
		fi

		if [ "$numSpaces" == "0" ] #if there's no spaces, we give up
			then 
			echo "$line"
			continue
		fi

		(( numtabs = numSpaces/spacesPerTab ))
	 
		insertTabs=$'\t'

		for (( i = 1; i < numTabs; i++ ))
		do
			insertTabs=$insertTabs"$"'\t'
		done

		echo "$line" | sed 's? *?'"$insertTabs"'?' 


done < "$1"
} > "/tmp/retab.tmp"

mv "/tmp/retab.tmp" "$1"